"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("history");function e(){return(e=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])}return r}).apply(this,arguments)}function n(r,e){(null==e||e>r.length)&&(e=r.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=r[n];return a}function a(r,e){var a="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(a)return(a=a.call(r)).next.bind(a);if(Array.isArray(r)||(a=function(r,e){if(r){if("string"==typeof r)return n(r,void 0);var a=Object.prototype.toString.call(r).slice(8,-1);return"Object"===a&&r.constructor&&(a=r.constructor.name),"Map"===a||"Set"===a?Array.from(r):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(r,void 0):void 0}}(r))||e&&r&&"number"==typeof r.length){a&&(r=a);var t=0;return function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function t(r){return Array.isArray(r)?r:[r]}function i(r){return"${p."+r+"}"}function o(r,e){var n={};return Object.keys(e).forEach((function(a){var t=e[a];t["~internal"].kind===r&&(n[a]=t)})),n}function u(r,e,n){var a=r["~internal"].valueSerializer.stringify(e);return n?encodeURIComponent(a):a}var l={__noMatch:!0},f=function(r,e){for(var n=0;n<e.length;n++)if(e[n]!==r[n])return!1;return!0},c=function(r,e){for(var n=1;n<=e.length;n++)if(e[e.length-n]!==r[r.length-n])return!1;return!0},s=function(r,e){var n=r.split(e);return[n[0],n.slice(1).join(e)]},p=c,m=f;function v(r){for(var n,t=r.object,i=r.paramDefs,o=r.urlEncodeDefault,u=r.arraySeparator,f={},c=Object.keys(i).map((function(r){return e({name:r},i[r])})),s=e({},t),p=function(){var r=n.value,e=t[r.name];if(delete s[r.name],void 0===e)return r["~internal"].optional?"continue":{v:!1};var a=void 0;if(null===e){if(!r["~internal"].array)return r["~internal"].optional?"continue":{v:!1};a=[]}else if(r["~internal"].array){if((a=e.split(u).map((function(e){var n;return r["~internal"].valueSerializer.parse((null!=(n=r["~internal"].valueSerializer.urlEncode)?n:o)?decodeURIComponent(e):e)}))).some((function(r){return r===l})))return r["~internal"].optional?"continue":{v:!1}}else{var i;if((a=r["~internal"].valueSerializer.parse((null!=(i=r["~internal"].valueSerializer.urlEncode)?i:o)?decodeURIComponent(e):e))===l)return r["~internal"].optional?"continue":{v:!1}}f[r.name]=a},m=a(c);!(n=m()).done;){var v=p();if("continue"!==v&&"object"==typeof v)return v.v}return{params:f,numExtraneousParams:Object.keys(s).length}}function d(r){var n=r.pathDefs,a=r.params,t=o("query",a),i=o("state",a),u={};return Object.keys(a).forEach((function(r){var e=a[r];void 0!==e["~internal"].default&&(u[r]=e["~internal"].default)})),function(r){var a=r.routerLocation,o=r.arraySeparator,f=r.queryStringSerializer;if(void 0===a.path)return!1;var c=function(r){for(var n=r.path,a=r.pathDefs,t=r.arraySeparator,i=0;i<a.length;i++){var o=u(a[i]);if(!1!==o)return e({},o,{primaryPath:0===i})}return!1;function u(r){var e={};if("/"===n&&0===r.length)return{params:e,numExtraneousParams:0};var a=n.length>1&&p(n,"/");a&&(n=n.slice(0,n.length-1));for(var i=n.split("/").slice(1),o=function(n){var o,u,f,c=n>=r.length?null:r[n],s=n>=i.length?null:i[n];if(null===c)return{v:!1};if(null===s)return 0==r.length-1-n&&null!=(f=c.namedParamDef)&&f["~internal"].optional?"break":{v:!1};if(null!=(o=c.namedParamDef)&&o["~internal"].trailing&&(s=i.slice(n).join("/")),!m(s,c.leading))return{v:!1};var v=s.slice(c.leading.length);if(!p(v,c.trailing))return{v:!1};var d=v.slice(0,v.length-c.trailing.length);if(!c.namedParamDef)return""===d?"continue":{v:!1};if(""===d)return c.namedParamDef["~internal"].optional?"continue":{v:!1};var y=null!=(u=c.namedParamDef["~internal"].valueSerializer.urlEncode)?u:!c.namedParamDef["~internal"].trailing,h=void 0;if(c.namedParamDef["~internal"].array){if((h=d.split(t).map((function(r){var e;return null==(e=c.namedParamDef)?void 0:e["~internal"].valueSerializer.parse(y?decodeURIComponent(r):r)}))).some((function(r){return r===l})))return{v:!1}}else if((h=c.namedParamDef["~internal"].valueSerializer.parse(y?decodeURIComponent(d):d))===l)return{v:!1};return c.namedParamDef["~internal"].trailing&&a&&""===c.trailing&&(h+="/"),e[c.namedParamDef.paramName]=h,c.namedParamDef["~internal"].trailing?"break":void 0},u=0;u<Math.max(r.length,i.length);u++){var f=o(u);if("break"===f)break;if("continue"!==f&&"object"==typeof f)return f.v}return{params:e,numExtraneousParams:0}}}({path:a.path,pathDefs:n,arraySeparator:o});if(!1===c)return!1;var s=function(r,e,n,a){var t={};return r&&(t=n.parse(r)),v({object:t,paramDefs:e,urlEncodeDefault:!0,arraySeparator:a})}(a.query,t,f,o);if(!1===s)return!1;var d=function(r,e,n){return v({object:null!=r?r:{},paramDefs:e,urlEncodeDefault:!1,arraySeparator:n})}(a.state,i,o);return!1!==d&&{primaryPath:c.primaryPath,params:e({},u,c.params,s.params,d.params),numExtraneousParams:c.numExtraneousParams+s.numExtraneousParams+d.numExtraneousParams}}}function y(r){return void 0===r&&(r={}),!(r.target&&r.target.target&&"_self"!==r.target.target||r.defaultPrevented||0!==r.button||r.metaKey||r.altKey||r.ctrlKey||r.shiftKey||(r&&r.preventDefault&&r.preventDefault(),0))}var h=f;function g(r){var n=r.routeName,a=r.params,t=r.location,i=r.routerContext,o=i.navigate,u=i.history.createHref({pathname:!1===n?t.fullPath:t.path,search:t.query?"?"+t.query:""});h(u,"#")&&(u="/"+u),!1!==n&&"/"!==i.baseUrl&&(u=i.baseUrl+u);var l={name:n,params:a,href:u,link:{href:u,onClick:function(r){if(y(r))return l.push()}},action:null,push:function(){return o(e({},l,{action:"push"}),!0)},replace:function(){return o(e({},l,{action:"replace"}),!0)}};return l}function S(r,n,l){var f,c,s,p,m=(f=o("path",n["~internal"].params),c=n["~internal"].path,s=Object.keys(f).map((function(r){return e({paramName:r},f[r])})),p={},s.forEach((function(r){var e=r.paramName;p[e]=i(e)})),t(c(p)).map((function(r){if(1===r.length)return[];for(var e,n=r.split("/").slice(1),t={},o=[],u=a(n);!(e=u()).done;){for(var l,f=e.value,c=null,p=a(s);!(l=p()).done;){var m=l.value;f.indexOf(i(m.paramName))>=0&&(c=m,t[m.paramName]=!0)}if(c){var v=f.split(i(c.paramName));o.push({leading:v[0],trailing:v[1],namedParamDef:c})}else o.push({leading:f,trailing:"",namedParamDef:null})}return s.map((function(r){return r.paramName})).filter((function(r){return!t[r]})),o}))),v=function(a){void 0===a&&(a={});var t=l(),i=t.arraySeparator,o=t.queryStringSerializer,f=t.baseUrl,c=e({},a);Object.keys(n["~internal"].params).forEach((function(r){var e=n["~internal"].params[r];void 0===c[r]&&void 0!==e["~internal"].default&&(c[r]=e["~internal"].default)}));var s=function(r){var n=r.paramCollection,a=r.paramDefCollection,t=r.arraySeparator,i=r.queryStringSerializer,o=r.pathDefs,l=r.baseUrl,f={path:{},query:{},state:{}},c=function(r){var e,i=n[r];if(void 0===i)return"continue";var o,l=a[r],c=null!=(e=l["~internal"].valueSerializer.urlEncode)?e:"state"!==l["~internal"].kind&&!l["~internal"].trailing;o=l["~internal"].array?0===i.length?null:i.map((function(r){return u(l,r,c)})).join(t):u(l,i,c),f[l["~internal"].kind][r]={valueSerializerId:l["~internal"].valueSerializer.id,array:l["~internal"].array,value:o}};for(var s in a)c(s);var p="/"+o[0].filter((function(r){var e=r.namedParamDef;return!(null!=e&&e["~internal"].optional&&void 0===f.path[e.paramName])})).map((function(r){var e=r.namedParamDef;return r.leading+(e?f.path[e.paramName].value:"")+r.trailing})).join("/");return{fullPath:("/"===l?"":l)+p,path:p,query:Object.keys(f.query).length>0?i.stringify(f.query):void 0,state:0===Object.keys(f.state).length?void 0:Object.keys(f.state).reduce((function(r,n){var a;return e({},r,((a={})[n]=f.state[n].value,a))}),{})}}({paramCollection:a,paramDefCollection:n["~internal"].params,arraySeparator:i,queryStringSerializer:o,pathDefs:m,baseUrl:f});return g({routeName:r,params:c,location:s,routerContext:t})};return Object.defineProperty(v,"name",{value:r}),v["~internal"]={type:"RouteBuilder",match:d({pathDefs:m,params:n["~internal"].params}),pathDefs:m,Route:null},v}function b(r){var e,n;void 0===r&&(r={});var t=null!=(e=r.queryStringArrayFormat)?e:"singleKeyWithBracket",i=null!=(n=r.arraySeparator)?n:",",o="multiKey"===t||"multiKeyWithBracket"===t,u="multiKey"===t||"singleKey"===t?"":"[]";return{parse:function(r){for(var e,n={},t=a(r.split("&"));!(e=t()).done;){var l=e.value.split("="),f=l[0],s=l[1],p=l.slice(2);if(!(void 0===f||p.length>0)){var m=decodeURIComponent(c(f,u)?f.slice(0,f.length-u.length):f);void 0===s?n[m]=null:n[m]&&o?n[m]+=""+i+s:n[m]=s}}return n},stringify:function(r){return Object.keys(r).map((function(e){var n=encodeURIComponent(e),a=r[e].array?""+n+u:n,t=r[e].value;return null===t?a:r[e].array&&o?t.split(i).map((function(r){return a+"="+r})).join("&"):a+"="+t})).join("&")}}}function P(r,n){var a=n.queryStringSerializer,t=n.arraySeparator,i=(0,n.getRoutes)(),o=!1;for(var u in i){var l=i[u]["~internal"].match({routerLocation:r,queryStringSerializer:a,arraySeparator:t});if(!1!==l){if(0===l.numExtraneousParams)return{route:i[u](l.params),primaryPath:l.primaryPath};(!1===o||l.numExtraneousParams<o.numExtraneousParams)&&(o=e({},l,{routeName:u}))}}return o?{route:i[o.routeName](o.params),primaryPath:o.primaryPath}:{route:g({routeName:!1,params:{},location:r,routerContext:n}),primaryPath:!0}}var D=f;function j(r,e){return{fullPath:r.pathname,path:D(r.pathname,e)?"/"!==e?r.pathname.replace(e,""):r.pathname:void 0,query:r.search?D(r.search,"?")?r.search.slice(1):r.search:void 0,state:"object"==typeof r.state&&null!==r.state?r.state.state:void 0}}var k=s;function w(r,e,n){var a=k(r,"?");return P(j({pathname:a[0],search:a[1],state:e},n.baseUrl),n)}function x(r){var e=r.startListening,n=r.stopListening,a=[],t=0;return{add:function(r){var i=t++;return a.push({id:i,handler:r}),1===a.length&&e(),function(){var r=a.map((function(r){return r.id})).indexOf(i);r>=0&&(a.splice(r,1),0===a.length&&n())}},getHandlers:function(){return a.map((function(r){return r.handler}))}}}function O(r,e){if("push"===r.action&&"object"==typeof window&&null!==window&&"function"==typeof window.scroll&&!1!==e&&"object"==typeof navigator&&null!==navigator&&"string"==typeof navigator.userAgent&&!(navigator.userAgent.indexOf("Node.js")>0||navigator.userAgent.indexOf("jsdom")>0))try{window.scroll(0,0)}catch(r){}}function E(r,e){var n={};if(r.name)for(var t,i=a(Object.keys(r.params).sort());!(t=i()).done;){var o=t.value,u=e[r.name]["~internal"].params[o]["~internal"];"state"===u.kind&&(n[o]=u.valueSerializer.stringify(r.params[o]))}return n}var z=s;function N(r){return{routeDefs:1===r.length?r[0]:r[1],opts:1===r.length?{}:r[0]}}function q(r){var e={},n=r().routeDefs;for(var a in n)e[a]=S(a,n[a],r);return e}function C(r){return 1===r.length?{params:{},path:function(){return r[0]}}:{params:r[0],path:r[1]}}var R={id:"boolean",parse:function(r){return"true"===r||"false"!==r&&l},stringify:function(r){return r?"true":"false"}},A={id:"number",parse:function(r){return e=r,isNaN(parseFloat(e))||!/^-?\d*\.?\d*$/.test(e)?l:parseFloat(r);var e},stringify:function(r){return r.toString()}},U={id:"string",parse:function(r){return r},stringify:function(r){return r}},I={path:e({},K("path",!1),{trailing:K("path",!0)}),query:K("query",!1),state:K("state",!1)};function K(r,n){return e({},a(!1,!1),{array:a(!1,!0),optional:e({},a(!0,!1),{array:a(!0,!0)})});function a(e,a){return{string:t({"~internal":{type:"ParamDef",array:a,kind:r,optional:e,valueSerializer:U,trailing:n,default:void 0}}),number:t({"~internal":{type:"ParamDef",array:a,kind:r,optional:e,valueSerializer:A,trailing:n,default:void 0}}),boolean:t({"~internal":{type:"ParamDef",array:a,kind:r,optional:e,valueSerializer:R,trailing:n,default:void 0}}),ofType:function(i){return void 0===i&&(i={id:"json",parse:function(r){var e;try{e=JSON.parse(r)}catch(r){return l}return e},stringify:function(r){return JSON.stringify(r)}}),t({"~internal":{type:"ParamDef",array:a,kind:r,optional:e,valueSerializer:i,trailing:n,default:void 0}})}}}function t(r){var n=r["~internal"];return n.optional?{"~internal":n,default:function(r){return{"~internal":e({},n,{default:r})}}}:{"~internal":n}}}exports.createGroup=function(r){var e={};return r.forEach((function(r){r.routeNames?r.routeNames.forEach((function(r){e[r]=!0})):e[r.name]=!0})),{"~internal":{type:"RouteGroup",Route:null},routeNames:Object.keys(e),has:function(r){return!1!==r.name&&!!e[r.name]}}},exports.createRouter=function(){for(var n,t,i,o,u,l=arguments.length,f=new Array(l),c=0;c<l;c++)f[c]=arguments[c];var s,p,m=N(f),v=m.routeDefs,d=m.opts,y=x({startListening:function(){p=s.listen((function(r){if(D)D=!1;else{var n=j(r.location,h),a=r.action.toLowerCase(),t=P(n,F()),i=t.primaryPath;H(e({},t.route,{action:a}),i)}}))},stopListening:function(){return null==p?void 0:p()}}),h=null!=(n=d.baseUrl)?n:"/",g=null!=(t=null==(i=d.arrayFormat)?void 0:i.separator)?t:",",S=null!=(o=d.queryStringSerializer)?o:b({queryStringArrayFormat:null==(u=d.arrayFormat)?void 0:u.queryString,arraySeparator:g}),D=!1,k=!1,C=null,R=null,A=[];K(d.session);var U=q(F),I={routes:U,session:{push:function(r,n){var a=w(r,n,F()),t=a.primaryPath;return L(e({},a.route,{action:"push"}),t)},replace:function(r,n){var a=w(r,n,F()),t=a.primaryPath;return L(e({},a.route,{action:"replace"}),t)},back:function(r){void 0===r&&(r=1),s.go(-r)},forward:function(r){void 0===r&&(r=1),s.go(r)},getInitialRoute:function(){if(!C){var r=P(j(s.location,h),F());r.primaryPath||(k=!0,r.route.replace(),r=P(j(s.location,h),F())),C=r.route}return C},reset:function(r){return K(r)},block:function(r){A.push(r);var n=s.block((function(n){var a=P(j(n.location,h),F()).route,t=n.action.toLowerCase();r({route:e({},a,{action:t}),retry:n.retry})}));return function(){A.splice(A.findIndex((function(e){return e===r})),1),n()}},listen:function(r){return y.add(r)}}};return I;function K(e){void 0===e&&(e={type:"undefined"!=typeof window&&void 0!==window.document?"browser":"memory"}),C=null,s="memory"===e.type?r.createMemoryHistory({initialEntries:e.initialEntries,initialIndex:e.initialIndex}):"hash"===e.type?r.createHashHistory({window:e.window}):r.createBrowserHistory({window:e.window})}function L(r,e){var n;if(A.length>0)A.forEach((function(e){e({route:r,retry:function(){r["push"===r.action?"push":"replace"]()}})}));else{var a=E(r,v);if((null==(n=R)?void 0:n.href)!==r.href||JSON.stringify(E(R,v))!==JSON.stringify(a)){k?k=!1:H(r,e),D=!0;var t=z(r.href,"?"),i=t[1];s["replace"===r.action?"replace":"push"]({pathname:t[0],search:i?"?"+i:"",hash:""},a?{state:a}:void 0)}}}function H(r,e){if(e){for(var n,t=a(y.getHandlers());!(n=t()).done;)(0,n.value)(r);O(r,d.scrollToTop),R=r}else r.replace()}function F(){return{queryStringSerializer:S,arraySeparator:g,navigate:L,history:s,routeDefs:v,getRoutes:function(){return U},baseUrl:h}}},exports.defineRoute=function r(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=C(a),u={"~internal":{type:"RouteDef",params:o.params,path:o.path},extend:function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var u=C(a),l=u.params,f=u.path,c=Object.keys(o.params),s=Object.keys(l);return c.filter((function(r){return s.indexOf(r)>=0})),r(e({},l,o.params),(function(r){var e,n=t(o.path(i(c))),a=t(f(i(s)));return(e=[]).concat.apply(e,n.map((function(r){return a.map((function(e){return"/"===r?e:r+("/"===e?"":e)}))})));function i(e){var n={};return e.forEach((function(e){n[e]=r[e]})),n}}))}};return u},exports.noMatch=l,exports.param=I,exports.preventDefaultLinkClickBehavior=y;
//# sourceMappingURL=type-route.cjs.production.min.js.map
